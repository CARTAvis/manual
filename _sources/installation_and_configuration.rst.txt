.. _link_installation_configuration:

==============================
Installation and Configuration
==============================
CARTA-desktop supports two operating systems: macOS and CentOS/Ubuntu Linux. CARTA-server, 
with the additional capability of ``shared session``, only supports CentOS/Ubuntu Linux 
operating system and is not publicly available. For people who want to use CARTA-server as the 
user interface for their image archive, please contact carta_helpdesk@asiaa.sinica.edu.tw 
for more information. CARTA-desktop can be retrieved at https://cartavis.github.io.

macOS 
-----
CARTA supports the latest three versions of macOS. Currently, they are 

* ``10.13 High Sierra``
* ``10.12 Sierra``
* ``10.11 El Capitan``

Earlier versions may be supported, but they are not tested.

To install CARTA on macOS, please follow the steps below:

Step 1: Download CARTA at: 

* http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r.dmg
* https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r.dmg
 

Step 2: Double click on the dmg file and drag the CARTA application to the */Applications* 
folder on your Mac. You may install CARTA to a directory other than */Applications*.

.. figure:: figures/carta_drag_install.png
   :width: 600 px

Step 3: Double click on the CARTA icon in the /Applications directory to start CARTA.


Now CARTA should be launched successfully. A *CARTA* folder with sample images 
and a hidden *.cartavis* folder (where you can find logs and the config.json configuration file)  
are copied to your *home* directory.

.. figure:: figures/carta_open_successfully_mac.png     
   


Linux
-----
CARTA supports the following Linux distributions:

* ``CentOS 7 / RHEL 7``
* ``CentOS 6 / RHEL 6``
* ``Ubuntu 17.04``
* ``Ubuntu 16.04 LTS`` 

Other Linux distributions may be supported, but they are not tested.

To install CARTA on Linux, please follow the steps below:

Step 1: Download CARTA at:

* CentOS 7/6, RHEL 7/6

  * http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r-el6-el7.tgz
  * https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r-el6-el7.tgz 

* Ubuntu 17.04, 16.04 LTS

  * http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r-ubuntu.tgz
  * https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r-ubuntu.tgz

You may use ``wget`` to retrieve the package.

For CentOS 7/6, RHEL 7/6::

  wget "http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r-el6-el7.tgz"
  wget "https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r-el6-el7.tgz"

For Ubuntu 17.04, 16.04 LTS::

  wget "http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r-ubuntu.tgz"
  wget "https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r-ubuntu.tgz"
  

Step 2: Extract the package.

For CentOS 7/6, RHEL 7/6::
 
  tar -xvf CARTA-0.9r-el6-el7.tgz

For Ubuntu 17.04, 16.04 LTS::

  tar -xvf CARTA-0.9r-ubuntu.tgz

Step 3: Launch CARTA by executing ``carta.sh``.

For CentOS 7/6, RHEL 7/6::

  CARTA-0.9r-el6-el7/bin/carta.sh

For Ubuntu 17.04, 16.04 LTS::

  CARTA-0.9r-ubuntu/bin/carta.sh

Now CARTA should be launched successfully. A *CARTA* folder with sample images 
and a hidden *.cartavis* folder (where you can find logs and the config.json configuration file)  
are copied to your *home* directory.

.. figure:: figures/carta_open_successfully_linux.png


For this release, we also provide the CARTA Linux versions as an *AppImage* (https://appimage.org).                 
AppImages have been gaining popularity on Linux in recent years. They are analagous to 
Applications on a Mac. They are a self-contained single file bundling the application 
itself and everything it needs to run on a system. 

To use a CARTA AppImage, download the appropriate version (CentOS 7/6 and RHEL 7/6, 
or Ubuntu 17.04, 16.04 LTS):

* For CentOS 7/6, RHEL 7/6

  * http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r-el6-el7.AppImage
  * https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r-el6-el7.AppImage

* For Ubuntu 17.04, 16.04 LTS

  * http://alma.asiaa.sinica.edu.tw/_downloads/CARTA-0.9r-ubuntu.AppImage
  * https://github.com/CARTAvis/carta/releases/download/v0.9/CARTA-0.9r-ubuntu.AppImage


Make the AppImage executable,

For CentOS 7/6, RHEL 7/6::

  chmod +x CARTA-0.9r-el6-el7.AppImage

For Ubuntu 17.04, 16.04 LTS::

  chmod +x CARTA-0.9r-ubuntu.AppImage

and simply execute it.

For CentOS 7/6, RHEL 7/6::

  ./CARTA-0.9r-el6-el7.AppImage

For Ubuntu 17.04, 16.04 LTS::

  ./CARTA-0.9r-ubuntu.AppImage


Installing Python Interface
---------------------------

.. figure:: figures/TBA.png
   :width: 300 px


.. _link_configuring_carta:

Configuring CARTA
-----------------

Plugin configuration
^^^^^^^^^^^^^^^^^^^^

CARTA is built on a *plugin* model and can be configured by a ``json`` file if desired. The default
plugin configuration should work for most of users. The plugin configuration file 
is located at::

  <your home>/.cartavis/config.json

and the default plugin configuration looks like::

  {
    "_comment" : "List of plugin directories",
    "pluginDirs": [
        "$(APPDIR)/../plugins",
        "$(APPDIR)/../../../../plugins"
    ],
    "disabledPlugins" : [""],
    "plugins": {
        "PCacheSqlite3" : {
            "dbPath": "$(HOME)/CARTA/cache/pcache.sqlite"
        }
    },
    "qtDecorations" : "true",
    "percentileApproximation" : "true",
    "percentApproxDividedNum" : 1000000
  }
  
If you want to disable a certain plugin, for example ``PCacheSqlite3``,
you can add ``"PCacheSqlite3"`` to the ``"disabledPlugins"`` list. 


Preference configuration
^^^^^^^^^^^^^^^^^^^^^^^^

CARTA provides the following user configurable options:

* percentile approximation::

  "percentileApproximation" : "true",
  "percentApproxDividedNum" : 1000000

  By default, CARTA adopts an approximation algorithm to find the clipping values 
  in the image cube in order to provide good performance for big image cube. Note that
  with this approximation algorithm (1000000 histogram bins), the bounding values of a 
  certain clipping percentage may differ a bit from the exact values.

* sqlite cache::

  "PCacheSqlite3" : {"dbPath": "$(HOME)/CARTA/cache/pcache.sqlite"}

  CARTA adopts sqlite database to cache data values in order to enhance performance. 
  For example, the minimum and maximum values of a certain image cube will be cached 
  in sqlite database so that when this image cube is opened for the second time, the 
  step of finding minimum and maximum values is skipped (usually very expensive for big 
  image cubes). Note that currently CARTA uses the file name of the image as the key in 
  sqlite database. Therefore, the cached values are not applicable to a totally different 
  image with an identical file name. Users may manually remove the cache at 
  <your home>/CARTA/cache/pcache.sqlite. CARTA team will improve this aspect in the 
  near future. 

